---
import '../styles/global.css';
import { siteConfig } from '@/config';

interface Props {
	title?: string;
    description?: string;
}

const { 
    title = siteConfig.site.title, 
    description = siteConfig.site.description 
} = Astro.props;
---

<!doctype html>
<html lang="en" class="scroll-smooth">
	<head>
		<meta charset="UTF-8" />
		<meta name="description" content={description} />
		<meta name="viewport" content="width=device-width" />
		<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=JetBrains+Mono:wght@400;500;700&display=swap" rel="stylesheet">
		<meta name="generator" content={Astro.generator} />
		<title>{title}</title>
	</head>
	<body class="bg-black text-neutral-300 selection:bg-emerald-900 selection:text-white antialiased opacity-0 overflow-x-hidden">
        
        <a href="#main-content" class="sr-only focus:not-sr-only focus:absolute focus:top-4 focus:left-4 focus:z-60 focus:px-4 focus:py-2 focus:bg-emerald-600 focus:text-black focus:font-mono focus:font-bold">
            Skip to main content
        </a>

        <nav aria-label="Main Navigation" class="fixed top-0 w-full z-50 bg-black/90 backdrop-blur-sm border-b border-neutral-800">
            <div class="max-w-7xl mx-auto flex justify-between items-center h-14 px-6 md:px-8">
                <a href="/" class="font-mono text-sm font-bold tracking-tight text-white z-50 relative" aria-label="{siteConfig.site.name} Home">
                    <span class="text-emerald-500 mr-2" aria-hidden="true">➜</span>{siteConfig.site.name}
                </a>
    
                <!-- Desktop Menu -->
                <ul class="hidden md:flex gap-6 md:gap-10 font-mono text-xs uppercase tracking-widest text-neutral-500">
                    {siteConfig.navigation.main.map((item) => (
                        <li><a href={item.href} class="hover:text-emerald-400 transition-colors duration-200">{item.name}</a></li>
                    ))}
                </ul>

                <!-- Mobile Toggle -->
                <button id="menu-toggle" class="md:hidden z-50 relative w-8 h-8 flex flex-col justify-center items-end gap-1.5 group" aria-label="Toggle Menu">
                    <span id="line-1" class="w-6 h-0.5 bg-white transition-all duration-300"></span>
                    <span id="line-2" class="w-4 h-0.5 bg-emerald-500 transition-all duration-300 group-hover:w-6"></span>
                </button>
            </div>
        </nav>

        <!-- Mobile Menu Overlay -->
        <div id="mobile-menu" class="fixed inset-0 bg-black z-40 flex items-center justify-center opacity-0 pointer-events-none">
            <ul class="flex flex-col items-center gap-8 font-mono text-2xl uppercase tracking-widest text-neutral-500">
                {siteConfig.navigation.main.map((item) => (
                    <li class="mobile-link overflow-hidden">
                        <a href={item.href} class="block hover:text-emerald-500 transition-colors translate-y-full">
                            {item.name}
                        </a>
                    </li>
                ))}
            </ul>
        </div>

        <main id="main-content" class="max-w-7xl mx-auto border-l border-r border-neutral-800 min-h-screen mt-14">
		    <slot />
        </main>

        <footer role="contentinfo" class="max-w-7xl mx-auto border-t border-neutral-800 py-8 px-6 flex justify-between items-center text-xs text-neutral-600 font-mono">
            <div>© {new Date().getFullYear()} {siteConfig.site.name}</div>
            <div>NO_TRACKING_COOKIES</div>
        </footer>

        <script>
            import { gsap } from "gsap";
            import { ScrollTrigger } from "gsap/ScrollTrigger";
            
            gsap.registerPlugin(ScrollTrigger);

            // --- Mobile Menu Logic ---
            const toggleBtn = document.getElementById('menu-toggle');
            const mobileMenu = document.getElementById('mobile-menu');
            const mobileLinkAnchors = document.querySelectorAll('.mobile-link a');
            const line1 = document.getElementById('line-1');
            const line2 = document.getElementById('line-2');

            let isMenuOpen = false;

            function toggleMenu() {
                isMenuOpen = !isMenuOpen;
                
                if (isMenuOpen) {
                    // Open
                    document.body.style.overflow = 'hidden'; // Lock scroll
                    
                    gsap.to(mobileMenu, { opacity: 1, pointerEvents: 'auto', duration: 0.4 });
                    gsap.to(mobileLinkAnchors, { 
                        y: 0, 
                        duration: 0.5, 
                        stagger: 0.1, 
                        delay: 0.1, 
                        ease: 'power3.out' 
                    });
                    
                    // Animate Burger to X
                    gsap.to(line1, { rotation: 45, y: 4, duration: 0.3 });
                    gsap.to(line2, { rotation: -45, y: -4, width: '1.5rem', backgroundColor: '#ffffff', duration: 0.3 });

                } else {
                    // Close
                    document.body.style.overflow = ''; // Unlock scroll
                    
                    gsap.to(mobileMenu, { opacity: 0, pointerEvents: 'none', duration: 0.4 });
                    gsap.to(mobileLinkAnchors, { y: '100%', duration: 0.3 });
                    
                    // Animate X back to Burger
                    gsap.to(line1, { rotation: 0, y: 0, duration: 0.3 });
                    gsap.to(line2, { rotation: 0, y: 0, width: '1rem', backgroundColor: '#10b981', duration: 0.3 });
                }
            }

            toggleBtn?.addEventListener('click', toggleMenu);

            // Close menu when a link is clicked
            mobileLinkAnchors.forEach(link => {
                link.addEventListener('click', () => {
                    if (isMenuOpen) toggleMenu();
                });
            });


            // --- Page Animations ---
            const hasVisited = sessionStorage.getItem("hasVisited");

            if (hasVisited) {
                // Subsequent visits: Show immediately, no navbar stagger
                gsap.set("body", { opacity: 1 });
            } else {
                // First visit: Play intro animations
                sessionStorage.setItem("hasVisited", "true");
                
                // Global Page Fade In
                gsap.to("body", { opacity: 1, duration: 0.5, ease: "power2.inOut" });

                // Navbar Stagger (Desktop)
                const navLinks = document.querySelectorAll("nav ul.hidden li"); // Only target desktop links
                if (window.innerWidth >= 768) { // Only animate on desktop to avoid weirdness
                    gsap.from(navLinks, {
                        y: -20,
                        opacity: 0,
                        duration: 0.8,
                        stagger: 0.1,
                        ease: "power3.out",
                        delay: 0.2
                    });
                }
            }
        </script>
	</body>
</html>