---
import Layout from '../../layouts/Layout.astro';
import { getCollection } from 'astro:content';

const posts = (await getCollection('blog'))
  .sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());
---

<Layout title="Writing | Ashlin Portfolio_">
    <!-- Header Section -->
    <section class="pt-32 pb-16 px-6 md:px-16 border-b border-neutral-800">
        <div class="max-w-4xl">
            <p class="header-animate font-mono text-emerald-500 text-sm mb-4 tracking-widest uppercase">
                // Index
            </p>
            
            <h1 class="header-animate text-5xl md:text-7xl font-semibold text-white tracking-tighter mb-8">
                Writing<span class="text-emerald-500">_</span>
            </h1>
            
            <p class="header-animate text-lg text-neutral-400 max-w-2xl leading-relaxed">
            My personal knowledge base. I write about what Iâ€™m building, what broke along the way, and how I fixed it.</p>
        </div>
    </section>

    <!-- Content Section -->
    <section class="grid md:grid-cols-12 border-b border-neutral-800">
        <div class="md:col-span-3 py-12 px-6 md:px-8 border-b md:border-b-0 md:border-r border-neutral-800 bg-neutral-900/20">
            <h2 class="font-mono text-xs text-neutral-500 uppercase tracking-widest sticky top-24">All Posts</h2>
        </div>

        <div class="md:col-span-9">
            <ul class="flex flex-col">
                {posts.map(post => (
                    <li class="blog-card group border-b border-neutral-800 hover:bg-neutral-900/30 transition-colors duration-150">
                        <article class="p-6 md:p-10 flex flex-col gap-6">
                            <div class="flex justify-between items-start">
                                <h3 class="text-2xl text-white font-medium group-hover:text-emerald-400 transition-colors">
                                    <a href={`/blog/${post.slug}`}>{post.data.title}</a>
                                </h3>
                                <a href={`/blog/${post.slug}`} class="font-mono text-xs text-emerald-500 border border-emerald-500 px-3 py-1 hover:bg-emerald-500 hover:text-black transition-colors uppercase" aria-label={`Read ${post.data.title}`}>
                                    Read Post
                                </a>
                            </div>
                            {post.data.description && (
                                <p class="text-neutral-400 max-w-2xl">
                                    {post.data.description}
                                </p>
                            )}
                            <div class="flex flex-wrap gap-x-6 gap-y-2 font-mono text-xs text-neutral-500 uppercase tracking-wider">
                                <time datetime={new Date(post.data.pubDate || Date.now()).toISOString()}>
                                    [ {new Date(post.data.pubDate || Date.now()).toLocaleDateString()} ]
                                </time>
                            </div>
                        </article>
                    </li>
                ))}
            </ul>
            
            {posts.length === 0 && (
                <div class="p-12 text-neutral-500 font-mono">
                    // No posts found.
                </div>
            )}
        </div>
    </section>
</Layout>

<script>
    import { gsap } from "gsap";
    import { ScrollTrigger } from "gsap/ScrollTrigger";
    
    gsap.registerPlugin(ScrollTrigger);

    // Header Animation
    gsap.from(".header-animate", {
        y: 20,
        opacity: 0,
        duration: 0.8,
        stagger: 0.15,
        ease: "power3.out",
        delay: 0.2
    });

    // Blog Cards Animation
    const cards = document.querySelectorAll(".blog-card");
    cards.forEach((card) => {
        gsap.from(card, {
            scrollTrigger: {
                trigger: card,
                start: "top 90%",
                toggleActions: "play none none reverse"
            },
            y: 30,
            opacity: 0,
            duration: 0.8,
            ease: "power2.out"
        });
    });
</script>
