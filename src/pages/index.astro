---
import Layout from '../layouts/Layout.astro';
import { siteConfig } from '@/config';
import { getCollection } from 'astro:content';

const recentPosts = (await getCollection('blog'))
  .sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf())
  .slice(0, 3);

const { hero, profile, stack, projects } = siteConfig.home;
---

<Layout>
    <section class="min-h-[85vh] flex flex-col justify-center px-6 md:px-16 border-b border-neutral-800 relative">
        <div class="max-w-4xl">
            <p class="hero-text font-mono text-emerald-500 text-sm mb-4 tracking-widest uppercase">
                {hero.label}
            </p>
            
            <h1 class="hero-text text-5xl md:text-7xl lg:text-8xl font-semibold text-white tracking-tighter leading-[1.1] mb-8">
                <span set:html={hero.headline} /><span class="text-emerald-500 cursor-blink">_</span>
            </h1>
            
            <p class="hero-text text-lg text-neutral-400 max-w-2xl leading-relaxed mb-12">
                {hero.description}
            </p>

            <div class="hero-text flex flex-col sm:flex-row gap-0 sm:gap-6 w-full sm:w-auto">
                <a href={hero.primaryBtn.href} class="group relative inline-flex items-center justify-center px-8 py-4 bg-emerald-600 text-black font-mono text-sm font-bold uppercase tracking-wider hover:bg-emerald-500 transition-colors">
                    {hero.primaryBtn.text}
                </a>
                <a href={hero.secondaryBtn.href} class="group inline-flex items-center justify-center px-8 py-4 border border-neutral-700 text-white font-mono text-sm font-bold uppercase tracking-wider hover:border-emerald-500 hover:text-emerald-500 transition-colors bg-black">
                    {hero.secondaryBtn.text}
                </a>
            </div>
        </div>

        <div class="absolute bottom-8 right-8 font-mono text-xs text-neutral-600 hidden md:block">
            SCROLL_DOWN [↓]
        </div>
    </section>

    <section id="about" aria-label="About Me" class="scroll-mt-10 gsap-section grid md:grid-cols-12 border-b border-neutral-800">
        <div class="md:col-span-3 py-12 px-6 md:px-8 border-b md:border-b-0 md:border-r border-neutral-800 bg-neutral-900/20">
            <h2 class="font-mono text-xs text-neutral-500 uppercase tracking-widest sticky top-24">01 — Profile</h2>
        </div>
        
        <div class="md:col-span-9 py-20 px-6 md:px-16">
            <h3 class="text-3xl text-white font-medium mb-8">{profile.heading}</h3>
            <div class="space-y-6 text-neutral-400 leading-relaxed text-lg">
                {profile.content.map(paragraph => (
                    <p>{paragraph}</p>
                ))}
            </div>
            
            {profile.stats && (
                <dl class="mt-12 pt-12 border-t border-neutral-800 grid grid-cols-2 md:grid-cols-4 gap-8">
                    {profile.stats.map(stat => (
                        <div>
                            <dt class="sr-only">Statistic Value</dt>
                            <dd class="block text-3xl font-bold text-white mb-1">{stat.value}</dd>
                            <dt class="font-mono text-xs text-neutral-500 uppercase">{stat.label}</dt>
                        </div>
                    ))}
                </dl>
            )}
        </div>
    </section>

    <section id="skills" aria-label="Tech Stack" class="scroll-mt-10 gsap-section grid md:grid-cols-12 border-b border-neutral-800">
        <div class="md:col-span-3 py-12 px-6 md:px-8 border-b md:border-b-0 md:border-r border-neutral-800 bg-neutral-900/20">
            <h2 class="font-mono text-xs text-neutral-500 uppercase tracking-widest sticky top-24">02 — Stack</h2>
        </div>

        <div class="md:col-span-9">
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-5 -mr-[1px] -mb-[1px]">
                {stack.map((group) => (
                    <div class="p-6 md:p-10 bg-black h-full border-r border-b border-neutral-800">
                        <h4 class="font-mono text-emerald-500 text-sm font-bold uppercase mb-6">{group.title}</h4>
                        <ul class="stagger-list space-y-3 font-mono text-sm text-neutral-400">
                            {group.items.map(item => (
                                <li class="flex items-center"><span class="w-1.5 h-1.5 bg-neutral-700 mr-3" aria-hidden="true"></span>{item}</li>
                            ))}
                        </ul>
                    </div>
                ))}
            </div>
        </div>
    </section>

    <section id="projects" aria-label="Selected Projects" class="scroll-mt-10 gsap-section grid md:grid-cols-12 border-b border-neutral-800">
        <div class="md:col-span-3 py-12 px-6 md:px-8 border-b md:border-b-0 md:border-r border-neutral-800 bg-neutral-900/20">
            <h2 class="font-mono text-xs text-neutral-500 uppercase tracking-widest sticky top-24">03 — Projects</h2>
        </div>

        <div class="md:col-span-9">
            {projects.map(project => (
                <article class="project-card group border-b border-neutral-800 hover:bg-neutral-900/30 transition-colors duration-150">
                    <div class="p-6 md:p-10 flex flex-col gap-6">
                        <div class="flex justify-between items-start">
                            <h3 class="text-2xl text-white font-medium group-hover:text-emerald-400 transition-colors">
                                {project.title}
                            </h3>
                            {project.links ? (
                                <div class="flex gap-4" aria-label="Project links">
                                    {project.links.map((link, i) => (
                                        <a href={link.href} class={`font-mono text-xs uppercase px-3 py-1 transition-colors ${i === 0 ? 'text-neutral-400 border border-neutral-700 hover:border-emerald-500 hover:text-emerald-500' : 'text-emerald-500 border border-emerald-500 hover:bg-emerald-500 hover:text-black'}`}>
                                            {link.text}
                                        </a>
                                    ))}
                                </div>
                            ) : (
                                project.link && (
                                    <a href={project.link.href} class="font-mono text-xs text-emerald-500 border border-emerald-500 px-3 py-1 hover:bg-emerald-500 hover:text-black transition-colors uppercase">
                                        {project.link.text}
                                    </a>
                                )
                            )}
                        </div>
                        <p class="text-neutral-400 max-w-2xl">
                            {project.description}
                        </p>
                        <div class="flex flex-wrap gap-x-6 gap-y-2 font-mono text-xs text-neutral-500 uppercase tracking-wider" aria-label="Technologies used">
                            {project.tags.map(tag => (
                                <span>{tag}</span>
                            ))}
                        </div>
                    </div>
                </article>
            ))}
        </div>
    </section>

    <section id="blog" aria-label="Recent Writing" class="scroll-mt-10 gsap-section grid md:grid-cols-12 border-b border-neutral-800">
        <div class="md:col-span-3 py-12 px-6 md:px-8 border-b md:border-b-0 md:border-r border-neutral-800 bg-neutral-900/20">
            <h2 class="font-mono text-xs text-neutral-500 uppercase tracking-widest sticky top-24">04 — Writing</h2>
        </div>

        <div class="md:col-span-9">
            {recentPosts.map(post => (
                <article class="blog-card group border-b border-neutral-800 hover:bg-neutral-900/30 transition-colors duration-150">
                    <div class="p-6 md:p-10 flex flex-col gap-4">
                        <div class="flex justify-between items-start">
                             <h3 class="text-xl text-white font-medium group-hover:text-emerald-400 transition-colors">
                                <a href={`/blog/${post.slug}`}>{post.data.title}</a>
                            </h3>
                            <time datetime={post.data.pubDate.toISOString()} class="font-mono text-xs text-neutral-500 uppercase tracking-wider">
                                {post.data.pubDate.toLocaleDateString()}
                            </time>
                        </div>
                        <p class="text-neutral-400 text-sm max-w-2xl line-clamp-2">
                            {post.data.description}
                        </p>
                        <a href={`/blog/${post.slug}`} class="font-mono text-xs text-emerald-500 hover:text-emerald-400 transition-colors uppercase tracking-wider mt-2" aria-label={`Read article: ${post.data.title}`}>
                            Read Article →
                        </a>
                    </div>
                </article>
            ))}
            
            <div class="p-6 md:p-10">
                <a href="/blog" class="font-mono text-xs text-emerald-500 border border-emerald-500 px-6 py-3 hover:bg-emerald-500 hover:text-black transition-colors uppercase inline-block">
                    View All Posts
                </a>
            </div>
        </div>
    </section>

    <section id="contact" aria-label="Contact Me" class="scroll-mt-10 gsap-section py-24 px-6 md:px-16 text-center">
        <h2 class="font-mono text-emerald-500 text-sm font-bold uppercase tracking-widest mb-6">
            // Initialize Handshake
        </h2>
        <h3 class="text-4xl md:text-5xl font-semibold text-white mb-8">
            Ready to collaborate?
        </h3>
        <p class="text-neutral-400 max-w-lg mx-auto mb-12">
            Currently open for freelance contracts and full-time opportunities. If you need clean code and solid architecture, let's talk.
        </p>
        
        <div class="inline-flex flex-col gap-6 w-full max-w-xs mx-auto">
            <a href={`mailto:${siteConfig.site.email}`} class="block w-full py-4 bg-emerald-600 text-black font-mono text-sm font-bold uppercase tracking-wider hover:bg-emerald-500 transition-colors">
                Send Email
            </a>
            
            <nav aria-label="Social Media Links" class="flex justify-center gap-8 font-mono text-xs text-neutral-500 uppercase tracking-widest">
                <a href={siteConfig.site.social.github} class="hover:text-white transition-colors">GitHub</a>
                <a href={siteConfig.site.social.linkedin} class="hover:text-white transition-colors">LinkedIn</a>
                <a href={siteConfig.site.social.twitter} class="hover:text-white transition-colors">Twitter</a>
            </nav>
        </div>
    </section>
</Layout>

<script>
    import { gsap } from "gsap";
    import { ScrollTrigger } from "gsap/ScrollTrigger";
    
    gsap.registerPlugin(ScrollTrigger);

    // Hero Text Stagger
    gsap.from(".hero-text", {
        y: 30,
        opacity: 0,
        duration: 1,
        stagger: 0.15,
        ease: "power3.out",
        delay: 0.5 // Wait for page fade in
    });

    // Section Reveals
    const sections = document.querySelectorAll(".gsap-section");
    sections.forEach((section) => {
        gsap.from(section, {
            scrollTrigger: {
                trigger: section,
                start: "top 80%", // When top of section hits 80% of viewport
                toggleActions: "play none none reverse"
            },
            y: 50,
            opacity: 0,
            duration: 1,
            ease: "power3.out"
        });
    });

    // Stagger Lists (Stack)
    const lists = document.querySelectorAll(".stagger-list");
    lists.forEach((list) => {
        const items = list.querySelectorAll("li");
        gsap.from(items, {
            scrollTrigger: {
                trigger: list,
                start: "top 85%"
            },
            x: -20,
            opacity: 0,
            duration: 0.6,
            stagger: 0.1,
            ease: "power2.out"
        });
    });

    // Project Cards Stagger
    // Assuming we want to animate them as they appear
    const projects = document.querySelectorAll(".project-card");
    projects.forEach((card, i) => {
        gsap.from(card, {
            scrollTrigger: {
                trigger: card,
                start: "top 85%"
            },
            y: 30,
            opacity: 0,
            duration: 0.8,
            ease: "power2.out"
        });
    });

    // Blog Cards Stagger
    const blogCards = document.querySelectorAll(".blog-card");
    blogCards.forEach((card) => {
        gsap.from(card, {
            scrollTrigger: {
                trigger: card,
                start: "top 85%"
            },
            y: 30,
            opacity: 0,
            duration: 0.8,
            ease: "power2.out"
        });
    });

</script>